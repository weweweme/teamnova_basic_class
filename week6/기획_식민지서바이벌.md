# 림월드 스타일 식민지 서바이벌 게임 (기획)

## 상태: 기획 진행 중

---

## 핵심 컨셉
- 낯선 행성에 불시착한 생존자들의 식민지 건설/방어 게임
- 콘솔(터미널) 아스키 아트, 실시간, 멀티스레딩
- 림월드에서 영감

## 확정된 사항

### 조작 방식
- ↑↓로 식민지인 순환 선택 (선택된 식민지인은 다른 색상)
- 선택 후 명령 부여 (이동/채집/건설/휴식)
- 식민지인들은 각자 스레드로 자율 행동

### 맵
- 스크롤 카메라 (선택된 식민지인 추적)
- 탑다운 뷰

### 식민지인
- 3명으로 시작, 이벤트로 추가 가능, 최대 20명
- 각 식민지인이 독립 스레드

### 시간 시스템
- 낮/밤 주기 (낮: 채집/건설, 밤: 적 습격)

### 자원 (4종 + 특수 1종)

**기본 자원**
| 자원 | 채집 대상 | 심볼 | 용도 | 재생 |
|------|----------|------|------|------|
| 나무 | 나무 | `T` | 기본 건설 | O |
| 돌 | 바위 | `o` | 고급 건설 | O |
| 식량 | 열매 덤불 | `*` | 식민지인 생존 (소비) | O |
| 철 | 철광석 | `=` | 고급 장비, 통신탑 | O |

**특수 자원**
| 자원 | 획득 방법 | 심볼 | 용도 | 재생 |
|------|----------|------|------|------|
| 부품 | 적 처치 드랍 + 맵 잔해에서 수집 | `&` | 통신탑 전용 | X |

- 기본 자원 재생: 채집 후 시간이 지나면 랜덤 빈 타일에 새로 생성
- 부품은 재생 안 됨 (잔해는 한정, 나머지는 적 드랍에 의존)

### 채집
| 자원 | 채집 시간 | 1회 획득량 | 채집 가능 횟수 | 총 획득량 |
|------|----------|-----------|--------------|----------|
| 식량 | 2초 | 2 | 3회 | 6 |
| 나무 | 3초 | 2 | 3회 | 6 |
| 돌 | 5초 | 2 | 3회 | 6 |
| 철 | 5초 | 1 | 3회 | 3 |
| 부품 | 3초 | 1 | 1회 | 1 |

- 채집 횟수를 다 소진하면 해당 타일에서 자원 사라짐

### 채집 시각 피드백
- 채집 진행도에 따라 블록 색상이 위→아래 순서로 변경 (초록 → 갈색/어두움)
- 각 블록의 문자 수로 진행도를 나눔
- 100% 도달하면 채집 횟수 1회 소모, 색상 초기화 (남은 횟수 있으면)

**재배 구역 (식량 수확)**
```
0% 수확       33% 수확      66% 수확      100% 수확
 %%(초록)      %%(갈색)      %%(갈색)      %%(갈색)
 %%(초록)      %%(초록)      %%(갈색)      %%(갈색)
 %%(초록)      %%(초록)      %%(초록)      %%(갈색)
```

**나무 (벌목)**
```
0% 벌목       30% 벌목      60% 벌목      100% 벌목
  ^(초록)       ^(갈색)       ^(갈색)       ^(갈색)
 /|\(초록)     /|\(초록)     /|\(갈색)     /|\(갈색)
  |(초록)       |(초록)       |(초록)       |(갈색) → 제거
```

**바위/철광석 (채굴)**
```
0% 채굴       50% 채굴      100% 채굴
 ___(회색)     ___(어두움)    ___(어두움)
|___|          |___|          |___| → 제거
```

### 식량 소비
- 식민지인 1명당 30초마다 식량 1 소비
- 식량 부족 시 단계적 패널티:
  1. 속도 저하: 식량 0이면 이동/채집 속도 50% 감소
  2. 체력 감소: 식량 0인 채로 30초 이상 지속되면 10초마다 체력 -10

### 레이어 렌더링

**시각 레이어** (화면에 보임, 위 레이어가 아래를 덮음)
```
Layer 3: 효과 (전투 이펙트, 피격 표시)
Layer 2: 개체 (식민지인, 적)
Layer 1: 오브젝트 (나무, 바위, 철광석, 잔해, 건물, 구역)
Layer 0: 지형 (물, 벽)
```
- UI 패널은 레이어가 아니라 별도로 오른쪽에 그림
- 빈 칸(공백)인 레이어는 아래가 보임

**논리 레이어** (화면에 안 보임, 내부 판정용)
| 레이어 | 역할 | 예시 |
|--------|------|------|
| 충돌 레이어 | 이동 가능/불가 판정 | 벽, 물, 나무 몸체 = 이동 불가 |
| 상호작용 레이어 | 채집/사용 가능 범위 | 나무 실제 3x4, 상호작용 범위 5x6 |
| 공격 범위 레이어 | 방어탑/원거리 사거리 | 방어탑 중심으로 반경 4칸 |
| 구역 레이어 | 작업 구역 범위 | 재배/벌목/채굴 구역 |

### 스레드 구조 (7종류, 식민지인/적은 동적 증가)

| 스레드 | 역할 | 간격 |
|--------|------|------|
| Main Thread | 입력 처리 + 렌더링 | 100ms (10 FPS) |
| Colonist Thread (x3~20) | 행동 + 식량 소비 + 피로 누적 + 패널티 | 500ms (피로/굶주림 시 느려짐) |
| Enemy Thread (습격 시) | 이동 + 공격 AI | 300ms |
| DayNightCycle Thread | 낮/밤 전환, 습격 판정 | 1000ms (1틱) |
| ResourceManager Thread | 맵에 자원 재생 (랜덤 위치 생성) | 주기적 |
| BuildingManager Thread | 건물 자동 동작 (방어탑 공격, 의무실 치료 등) | 주기적 |
| EventManager Thread | 랜덤 이벤트 판정 및 발동 | 주기적 |

### 스레드 상세 동작

**Main Thread**
```
while (게임 진행 중) {
    입력 체크 (논블로킹) → 입력 처리 → 상태 스냅샷 → 렌더링 → 프레임 대기
}
```

**Colonist Thread**
```
while (살아있음) {
    적이 근처 → 전투 (최우선)
    명령 큐에 명령 → 명령 실행
    배정된 구역 → 구역 작업
    아무것도 없음 → 대기
    식량 소비/피로 누적/패널티 체크
    Thread.sleep(간격)
}
```

**Enemy Thread**
```
while (살아있음) {
    가장 가까운 식민지인/건물 탐색 → 이동 → 인접 시 공격 → 체력 0이면 종료
    Thread.sleep(300ms)
}
```

**DayNightCycle Thread**
```
while (게임 진행 중) {
    틱 증가 → 낮→밤: 습격 확률 판정, 적 스레드 생성 → 밤→낮: 적 철수, 이벤트 판정
    Thread.sleep(1000ms)
}
```

### 공유 자원 동기화

| 공유 자원 | 접근 스레드 | 동기화 |
|----------|------------|--------|
| GameMap (타일/위치) | 식민지인, 적, 렌더링, ResourceManager | synchronized — 이동 시 원자적 변경 |
| Inventory (자원) | 식민지인, BuildingManager, 메인(UI) | synchronized — 추가/소비 |
| Colony (식민지인/적 목록) | 메인, DayNightCycle, EventManager | synchronized — 목록 순회/추가/제거 |
| Colonist 명령 큐 | 메인(명령 추가), 식민지인(꺼내기) | synchronized + wait/notify |

### 화면 레이아웃 (80x24)
```
+--------------------------------------------------+--------------------+
|                                                  | [자원]              |
|                맵 뷰포트 (50x18)                  |  나무: 50          |
|                                                  |  돌: 30            |
|  . . . T T . . . . . . . T . . . .              |  식량: 20          |
|  . . T T . @ . . . . . . . . . . .              |                    |
|  . . . . . . . . # # . . . . . . .              | [식민지인]          |
|  ~ ~ . . . . . . . . . . . T . . .              |  > 김철수 (채집중)  |
|                                                  |    이영희 (대기)    |
|                                                  | [시간] 3일차 낮    |
+--------------------------------------------------+--------------------+
| ↑↓: 식민지인 선택 | Enter: 명령 | q: 종료                              |
+--------------------------------------------------------------------+
```

### 건물
| 건물 | 심볼 | 비용 | 효과 |
|------|------|------|------|
| 나무 벽 | `#` | 나무 5 | 이동 차단 (체력 낮음) |
| 돌 벽 | `#` | 돌 5 | 이동 차단 (체력 높음) |
| 저장고 | `S` | 나무 10 | 자원 저장 한도 +50 |
| 침실 | `B` | 나무 8 | 체력 회복 장소 |
| 방어탑 | `A` | 돌 15 | 주변 적 자동 공격 |
| 작업대 | `W` | 나무 8, 돌 3 | 장비 제작 가능 |
| 의무실 | `+` | 나무 10, 돌 5 | 빠른 체력 회복 |
| 통신탑 | `Y` | 나무 20, 돌 20, 철 15, 부품 10 | 건설 완료 시 승리 |

### 자원 저장 한도
- 기본 한도: 자원별 50개
- 저장고 1개당: +50 추가

### 구역 시스템
- 플레이어가 타일 범위를 지정 → 식민지인이 자동으로 해당 구역에서 작업
- Zone 기본 클래스를 상속하여 구현

| 구역 | 심볼 | 비용 | 효과 |
|------|------|------|------|
| 재배 구역 | `%` | 식량 3 | 식량 자동 생산 |
| 벌목 구역 | (나무 위에 지정) | 없음 | 나무 자동 채집 |
| 채굴 구역 | (바위 위에 지정) | 없음 | 돌 자동 채집 |

### 화면 설계

**화면 크기**: 120x36 (80x24의 1.5배)

**레이아웃**: 맵(왼쪽) + 현황 패널(오른쪽, `|||`로 구분) + 하단 명령바
- 빈 땅은 공백 처리 (깔끔)
- 오브젝트만 맵에 그려서 한눈에 보이게

**타일 블록**: 각 타일 4x2 문자 (가로 4 x 세로 2)

### 아스키 심볼 (4x2 블록)
| 요소 | 심볼 | 색상 |
|------|------|------|
| 빈 땅 | (공백) | - |
| 나무 | ` ^ ` / `/\|\` | 초록 |
| 바위 | ` __ ` / `\|_\|` | 회색 |
| 철광석 | `/==\` / `\==/` | 회색 밝음 |
| 물 | `~~~~` / `~~~~` | 파랑 |
| 벽 | `████` / `████` | 흰색 |
| 재배구역 | ` %% ` / ` %% ` | 초록 |
| 잔해 | `[&&]` / ` ## ` | 노랑 |
| 식민지인 | `(A)` ~ `(T)` / ` \| ` | 밝은 초록 (이니셜로 구분) |
| 선택된 식민지인 | 위와 동일 | 밝은 노랑 (반전) |
| 적 | `(X)` / ` \| ` | 빨강 |

### 화면 예시
```
              (A)                 ^                                      ||| 나무:  30/50
               |                /|\        ___                           ||| 돌:    20/50
                                          |___|      /==\                ||| 식량:  15/50
         (B)          (X)                  \==/                ||| 철:     5/50
          |            |                                                 ||| 부품:  3
                                 (C)           ███ ███                   |||
    ^                             |            ███ ███                   ||| ───────────
   /|\             %%                                          ^        ||| [A] 김철수
                   %%       ___                               /|\       ||| 상태: 채집중
                           |___|                                        ||| 체력: ████░ 80
         %%                              ~~~                            ||| 피로: ██░░░ 30
         %%    ^                         ~~~         /==\               ||| 무기: 칼
              /|\                                    \==/               ||| 갑옷: 가죽
    ^                  ^                    ^                            |||
   /|\                /|\                  /|\                          ||| [3일차 낮]
                                                                        ||| 식민지인: 3명
────────────────────────────────────────────────────────────────────────|||
 ↑↓: 식민지인 선택 | Enter: 명령 | 1:이동 2:채집 3:건설 4:제작 | q: 메뉴 |||
```

### 전투 시스템
- 식민지인 행동 우선순위: 전투 > 플레이어 명령 > 구역 자동 작업 > 자율 행동
- 적이 근처에 오면 자동 반격
- 장비에 따라 근접/원거리 결정

### 장비 슬롯
- 무기 1칸 + 방어구 1칸

### 무기
| 장비 | 타입 | 공격력 | 사거리 | 제작 비용 | 드랍 |
|------|------|--------|--------|----------|------|
| 맨손 | 근접 | 5 | 1칸 | - | - |
| 방망이 | 근접 | 10 | 1칸 | 나무 5 | O |
| 칼 | 근접 | 15 | 1칸 | 돌 8 | O |
| 활 | 원거리 | 8 | 5칸 | 나무 8 | O |
| 총 | 원거리 | 12 | 7칸 | 돌 12 | O |

### 방어구
| 장비 | 방어력 | 효과 | 제작 비용 | 드랍 |
|------|--------|------|----------|------|
| 없음 | 0 | - | - | - |
| 가죽 갑옷 | 5 | 받는 데미지 -5 | 나무 5 | O |
| 철 갑옷 | 10 | 받는 데미지 -10 | 돌 10 | O |

- 제작: 작업대 건물 필요
- 드랍: 적 처치 시 확률적으로 획득

### 식민지인 스탯
| 스탯 | 최대치 | 감소 조건 | 회복 방법 |
|------|--------|----------|----------|
| 체력 | 100 | 전투 피격, 굶주림 | 침실 휴식 (느림, 10초당 +5), 치료 키트 (즉시 +30), 의무실 (빠름, 10초당 +15) |
| 피로도 | 100 | 활동 중 시간 경과로 누적 | 침실에서 수면 |

### 피로도 시스템
- 활동 중 일정 시간마다 피로 +1
- 피로 70 이상: 행동 속도 30% 감소
- 피로 90 이상: 행동 속도 50% 감소
- 피로 100: 그 자리에서 쓰러져 수면 (위험!)

### 치료 시스템
| 방법 | 체력 회복 | 조건 |
|------|----------|------|
| 침실 휴식 | 느림 (10초당 +5) | 침실 건물 |
| 치료 키트 | 즉시 +30 | 작업대에서 제작 (나무 3, 식량 3) |
| 의무실 | 빠름 (10초당 +15) | 의무실 건물 |

### 체력
| 대상 | 체력 |
|------|------|
| 식민지인 | 100 |
| 적 (근접) | 30 |
| 적 (원거리) | 20 |
| 나무 벽 | 30 |
| 돌 벽 | 80 |
| 방어탑 | 60 |

### 적 종류
| 타입 | 무기 | 특징 |
|------|------|------|
| 근접 | 방망이/칼 | 식민지인/건물에 붙어서 공격 |
| 원거리 | 총/활 | 일정 거리에서 사격 |

### 습격 패턴
- 맵 가장자리 랜덤 방향에서 무리 단위로 출현
- 무리가 뭉쳐서 이동
- 확률적으로 습격이 없는 날도 있음

| 날짜 | 습격 확률 | 적 수 | 구성 |
|------|----------|------|------|
| 1~2일차 | 0% | - | 안전 |
| 3~4일차 | 30% | 2~3명 | 근접만 |
| 5~6일차 | 50% | 4~5명 | 근접 위주, 원거리 1 |
| 7~9일차 | 60% | 6~7명 | 근접/원거리 반반 |
| 10~12일차 | 70% | 8~10명 | 원거리 비율 증가 |
| 13일차+ | 80% | 12명+ | 계속 강해짐 |

### 승리/패배 조건
- **승리**: 통신탑 건설 완료 → 구조 신호 발신 → 엔딩
- **엔드리스**: 통신탑을 안 지으면 끝없이 생존 (최대 생존 일수 기록)
- **패배**: 식민지인 전멸

### 이벤트 (구현하면서 조정 가능)
| 이벤트 | 효과 |
|--------|------|
| 새 생존자 발견 | 식민지인 +1 |
| 보급품 투하 | 랜덤 위치에 자원/부품 드랍 |
| 폭풍 | 일정 시간 동안 시야 감소, 이동 속도 저하 |
| 질병 | 랜덤 식민지인 체력 서서히 감소 (의무실 필요) |
| 잔해 발견 | 맵에 우주선 잔해 출현 (부품 획득 기회) |

## 미정 사항 (TODO)
- [x] 채집 (속도/채집량/여러 번 채집)
- [x] 식량 소비 및 부족 시 처리 (속도 저하 → 체력 감소)
- [x] 건물 종류와 효과 (벽/저장고/침실/방어탑)
- [x] 자원 저장 한도 (기본 50, 저장고당 +50)
- [x] 구역 시스템 (재배/벌목/채굴)
- [x] 적 종류 (근접/원거리)
- [x] 습격 패턴 (확률 기반, 날짜별 스케일링)
- [x] 전투 시스템 (자동 반격, 우선순위, 공격력/방어력/사거리)
- [x] 장비 시스템 (무기/방어구, 제작+드랍, 작업대)
- [x] 식민지인 스탯 (체력/피로도, 치료 시스템, 의무실)
- [x] 승리/패배 조건 (통신탑 승리 / 엔드리스 / 전멸 패배)
- [x] 이벤트 종류 (5종, 구현 시 조정)

## 구현 설계

### 패키지 구조
```
src/
  Main.java
  core/       Util, Config, Direction, Position
  map/        TileType, Tile, GameMap, MapGenerator
  render/     Camera, Layer, Renderer
  entity/     Entity, Colonist, ColonistState, Enemy, MeleeEnemy, RangedEnemy
  command/    Command, MoveCommand, GatherCommand, BuildCommand, CraftCommand, RestCommand
  building/   Building, Wall, WoodWall, StoneWall, StorageBuilding, Bedroom, DefenseTower, Workbench, Infirmary, CommTower
  zone/       Zone, FarmZone, LumberZone, MineZone
  resource/   ResourceType, Inventory
  equipment/  Equipment, Weapon, Armor
  event/      GameEvent, RaidEvent, NewColonistEvent, SupplyDropEvent, StormEvent, DiseaseEvent, WreckageEvent
  game/       Game, DayNightCycle, Colony
```

### 상속 구조
```
Entity (기본 개체)
 ├── Colonist (식민지인)
 └── Enemy (적)
      ├── MeleeEnemy (근접)
      └── RangedEnemy (원거리)

Building (건물 기본) — 건물마다 고유 동작이 다르므로 상속
 ├── Wall (벽)
 │    ├── WoodWall (나무 벽)
 │    └── StoneWall (돌 벽)
 ├── StorageBuilding (저장고)
 ├── Bedroom (침실)
 ├── DefenseTower (방어탑) — 자동 공격
 ├── Workbench (작업대) — 장비 제작
 ├── Infirmary (의무실) — 체력 회복
 └── CommTower (통신탑) — 승리 조건

Zone (구역 기본) — 결과물과 작업 시간만 다름
 ├── FarmZone (재배)
 ├── LumberZone (벌목)
 └── MineZone (채굴)

Command (명령 인터페이스)
 ├── MoveCommand (이동)
 ├── GatherCommand (채집)
 ├── BuildCommand (건설)
 ├── CraftCommand (제작)
 └── RestCommand (휴식)

Equipment (장비 기본)
 ├── Weapon (무기)
 └── Armor (방어구)

GameEvent (이벤트 인터페이스)
 ├── RaidEvent (습격)
 ├── NewColonistEvent (새 생존자)
 ├── SupplyDropEvent (보급품)
 ├── StormEvent (폭풍)
 ├── DiseaseEvent (질병)
 └── WreckageEvent (잔해 발견)
```

### 게임 루프
```
프로그램 시작 → 타이틀 화면 → 게임 초기화 (맵 생성, 식민지인 3명)
    ↓
스레드 시작 (Colonist x3, DayNight, ResourceMgr, BuildingMgr, EventMgr)
    ↓
┌─── 게임 루프 (Main Thread) ───┐
│  1. 입력 체크 (논블로킹)        │
│  2. 입력 처리                   │
│  3. 게임 상태 스냅샷            │
│  4. 시각 레이어 합성 → 출력     │
│  5. Frame 대기 (100ms)         │
│                                │
│  종료: 승리/패배/나감           │
└────────────────────────────────┘
    ↓
모든 스레드 종료 → 결과 화면 → 타이틀
```

### 스레드 간 상호작용
```
                      ┌─────────────┐
                      │ Main Thread │
                      │(입력+렌더링) │
                      └──────┬──────┘
                 입력처리     │    스냅샷+렌더링
           ┌────────────────┼────────────────┐
           ▼                ▼                 ▼
  ┌────────────┐  ┌────────────┐  ┌────────────┐
  │ Colonist A │  │ Colonist B │  │ Colonist C │
  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘
        │               │               │
        ▼               ▼               ▼
  ┌──────────────────────────────────────────┐
  │        공유 자원 (synchronized)            │
  │  GameMap / Inventory / Colony             │
  └───┬──────────┬──────────┬──────────┬─────┘
      ▼          ▼          ▼          ▼
 ┌─────────┐┌──────────┐┌─────────┐┌─────────┐
 │DayNight ││ Resource ││Building ││  Event  │
 │  Cycle  ││ Manager  ││ Manager ││ Manager │
 └────┬────┘└──────────┘└─────────┘└─────────┘
      │ 밤 → 습격
      ▼
 ┌────────┐┌────────┐
 │Enemy 1 ││Enemy 2 │ ...
 └────────┘└────────┘
```

### 구현 단계 (12단계, 각 단계마다 컨펌)

**Phase 1: 코어 + 맵 + 렌더링 기초**
- Config, Position, Direction, Util 색상 추가
- TileType, Tile, GameMap, MapGenerator
- Layer, Camera, Renderer (Layer 0만 — 지형)
- 4x2 블록 렌더링
- 결과: 랜덤 맵(나무, 바위, 물, 철광석)이 화면에 표시

**Phase 2: 입력 + 카메라 이동**
- Game.java 게임 루프 (논블로킹 입력)
- 화살표로 카메라 이동 (임시 직접 조작)
- UI 패널 (오른쪽 ||| 구분)
- 결과: 화살표로 맵 스크롤 탐색, 우측 패널 표시

**Phase 3: 식민지인 표시 + 선택**
- Entity, Colonist (데이터만), ColonistState, Colony
- Layer 2 렌더링, ↑↓로 식민지인 순환 선택
- 결과: (A)(B)(C) 3명 보이고, 선택 순환 + 카메라 추적

**Phase 4: 식민지인 스레드 (핵심 멀티스레딩!)**
- Colonist extends Thread, run() 루프
- 자율 배회, GameMap synchronized, 렌더링 스냅샷
- 결과: 식민지인들이 각자 독립적으로 돌아다님

**Phase 5: 논리 레이어 + 충돌**
- 충돌 레이어 (이동 불가 판정)
- 상호작용 레이어 (채집/사용 가능 범위)
- 결과: 식민지인이 장애물을 피해서 이동

**Phase 6: 명령 + 자원 + 채집**
- Command, MoveCommand, GatherCommand
- 명령 큐 (synchronized + wait/notify)
- ResourceType, Inventory, UI 자원 표시
- 채집 시각 피드백 (진행도 색상 변경)
- 결과: 채집 명령 → 자원 수집 (색상 변화)

**Phase 7: 건설 시스템**
- Building 상속 구조, BuildCommand, 건설 비용 차감
- 저장 한도 시스템
- 결과: 자원으로 벽/저장고/침실 건설

**Phase 8: 구역 시스템**
- Zone 상속 구조, 구역 지정 UI
- 식민지인 자동 구역 작업
- 결과: 구역 지정 → 식민지인이 알아서 일함

**Phase 9: 낮/밤 + 적 + 전투**
- DayNightCycle Thread, Enemy 상속 Thread
- 전투 시스템, 공격 범위 레이어
- 방어탑 자동 공격 (BuildingManager Thread)
- Layer 3 (전투 이펙트)
- 결과: 낮에 준비, 밤에 적 침입 + 전투

**Phase 10: 장비 + 제작**
- Equipment 상속 (Weapon, Armor)
- CraftCommand, Workbench 연동, 적 드랍
- 결과: 작업대에서 무기/갑옷 제작, 장착

**Phase 11: 매니저 스레드 + 이벤트 + 스탯**
- ResourceManager, EventManager Thread
- 식량 소비 + 피로 누적 (Colonist Thread 내)
- Infirmary 치료, 치료 키트
- 결과: 자원 재생, 이벤트, 생존 압박

**Phase 12: 승리 + 마무리**
- CommTower → 승리, 엔드리스 모드
- 패배 (전멸), 타이틀 화면, 결과 통계
- 결과: 완성된 게임
