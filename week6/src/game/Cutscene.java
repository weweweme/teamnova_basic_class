package game;

/// <summary>
/// ASCII 아트 컷씬을 재생하는 클래스
/// 여러 프레임을 순서대로 표시하며, 아무 키를 누르면 다음 프레임으로 넘어감
/// </summary>
public class Cutscene {

    /// <summary>
    /// 각 프레임의 줄 배열
    /// </summary>
    private final String[][] frames;

    /// <summary>
    /// 각 프레임의 표시 시간 (밀리초)
    /// </summary>
    private final int[] durations;

    /// <summary>
    /// 프레임 목록과 표시 시간으로 컷씬 생성
    /// </summary>
    public Cutscene(String[][] frames, int[] durations) {
        this.frames = frames;
        this.durations = durations;
    }

    /// <summary>
    /// 컷씬 재생
    /// 각 프레임을 표시 시간만큼 보여주고, 아무 키를 누르면 즉시 다음으로 넘어감
    /// </summary>
    public void play() {
        // 프레임 사이 키 입력 확인 간격 (밀리초)
        final int CHECK_INTERVAL = 50;

        for (int i = 0; i < frames.length; i++) {
            // 화면 지우고 프레임 출력
            Util.clearScreen();
            StringBuilder screen = new StringBuilder();
            for (String line : frames[i]) {
                screen.append(line);
                screen.append('\n');
            }
            System.out.print(screen);
            System.out.flush();

            // 표시 시간 동안 대기, 키 입력 시 즉시 다음 프레임
            long deadline = System.currentTimeMillis() + durations[i];
            while (System.currentTimeMillis() < deadline) {
                // 주의: System.in.available()은 checked exception이라 try-catch 필수 (컴파일러 요구)
                try {
                    if (System.in.available() > 0) {
                        Util.readKey();
                        break;
                    }
                } catch (Exception e) {
                    // IOException (컴파일러 요구사항)
                }
                Util.delay(CHECK_INTERVAL);
            }
        }
    }

    /// <summary>
    /// 인트로 컷씬 — 난파선에서 해변에 표착하는 이야기
    /// </summary>
    public static Cutscene intro() {
        String[][] frames = {
            {
                "",
                "",
                "",
                "                    ~             ~",
                "               ~        ~              ~",
                "          ~                    ~",
                "     ~~~ ___  ~~~  ~~~  ~~~  ~~~  ~~~  ~~~",
                "    ~   /   \\___         ~~~         ~~~",
                "   ~~~ |  X  X  |  ~~~        ~~~",
                "    ~   \\__+__/    ~    폭풍이 몰아친다...",
                "     ~~~  |__|  ~~~  ~~~  ~~~  ~~~  ~~~",
                "    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "",
                "",
                "              [ 아무 키를 눌러 계속 ]",
            },
            {
                "",
                "",
                "",
                "",
                "                          . .  .  . .",
                "                        .            .",
                "                      .    ........",
                "                     .   / 표류자들 /",
                "        ___         .   /  3명이   /",
                "    ~~~/ _ \\~~~    .   / 해변에   /",
                "   ~~~| (_) |~~~  .  / 표착했다 /",
                "    ~~ \\___/ ~~   . /________/",
                "   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "     ~  ~  ~  ~  ~  ~  ~  ~  ~  ~",
                "   _____________________________________",
                "  |.....................................|",
                "",
                "              [ 아무 키를 눌러 계속 ]",
            },
            {
                "",
                "",
                "          ┌───────────────────────────────────┐",
                "          │                                   │",
                "          │   3명의 표류자가 해변에 도착했다   │",
                "          │                                   │",
                "          │   밀려오는 야수들로부터             │",
                "          │   살아남아야 한다.                 │",
                "          │                                   │",
                "          │   낮에는 준비하고,                  │",
                "          │   밤에는 싸워라.                    │",
                "          │                                   │",
                "          │   바리케이드가 마지막 방어선이다.   │",
                "          │                                   │",
                "          └───────────────────────────────────┘",
                "",
                "",
                "              [ 아무 키를 눌러 시작 ]",
            },
        };

        int[] durations = {5000, 5000, 5000};

        return new Cutscene(frames, durations);
    }

    /// <summary>
    /// 승리 컷씬 — 구출되어 탈출하는 이야기
    /// </summary>
    public static Cutscene victory() {
        String[][] frames = {
            {
                "",
                "",
                "",
                "",
                "                        |",
                "                       /|\\",
                "                      / | \\",
                "                     /  |  \\",
                "                    /___|___\\",
                "                   |         |",
                "          ~~~~~~~~~|_________|~~~~~~~~~",
                "         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "          ~~~  구출선이 도착했다!  ~~~",
                "         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "",
                "",
                "              [ 아무 키를 눌러 계속 ]",
            },
            {
                "",
                "",
                "          ┌───────────────────────────────────┐",
                "          │                                   │",
                "          │         ★  승 리  ★              │",
                "          │                                   │",
                "          │   표류자들은 끝까지 버텨냈다.      │",
                "          │                                   │",
                "          │   마침내 구출선이 도착하여         │",
                "          │   섬을 탈출할 수 있게 되었다.      │",
                "          │                                   │",
                "          │   당신의 지휘 덕분에               │",
                "          │   모두가 살아남았다.               │",
                "          │                                   │",
                "          └───────────────────────────────────┘",
                "",
                "",
                "              [ 아무 키를 눌러 종료 ]",
            },
        };

        int[] durations = {4000, 5000};

        return new Cutscene(frames, durations);
    }

    /// <summary>
    /// 게임오버 컷씬 — 전원 사망
    /// </summary>
    public static Cutscene gameOver() {
        String[][] frames = {
            {
                "",
                "",
                "",
                "",
                "                    \\  |  /",
                "                     \\ | /",
                "                   ----*----",
                "                     / | \\",
                "                    /  |  \\",
                "",
                "              마지막 정착민이 쓰러졌다...",
                "",
                "         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "          ~~~  아무도 살아남지 못했다  ~~~",
                "         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
                "",
                "",
                "              [ 아무 키를 눌러 계속 ]",
            },
            {
                "",
                "",
                "          ┌───────────────────────────────────┐",
                "          │                                   │",
                "          │        ×  게임 오버  ×            │",
                "          │                                   │",
                "          │   표류자들은 야수들에게             │",
                "          │   끝내 무릎을 꿇었다.              │",
                "          │                                   │",
                "          │   이 섬에서 탈출한 자는            │",
                "          │   아무도 없었다...                 │",
                "          │                                   │",
                "          └───────────────────────────────────┘",
                "",
                "",
                "              [ 아무 키를 눌러 종료 ]",
            },
        };

        int[] durations = {4000, 5000};

        return new Cutscene(frames, durations);
    }
}
